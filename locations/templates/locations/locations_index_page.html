{% extends "base.html" %}

{% load wagtailcore_tags wagtailimages_tags %}

{% block body_class %}template-locationsindexpage{% endblock %}

{% block content %}


    <h1 class="text-center mt-5">{{ page.title }}</h1>

    <div class="intro">{{ page.intro|richtext }}</div>

    {% if page.promoted_pages.count %}
    <div class="promoted_pages">
        Promoted:
        <ul>
        {% for promoted_page in page.promoted_pages.all %}
            <li>{{ promoted_page.page.title }}</li>
        {% endfor %}
        </ul>
    </div>
    {% endif %}


    {% if locationsnearme %}
       <h4 class="text-center mt-5"> Near me üìç :</h4>
	
	<ul class="list-group mt-5 px-2 text-center">
		{% for location_page in locationsnearme %}
			{% if location_page == locationsnearme.0 %}
 				<a href="{% pageurl location_page  %}"><li class="list-group-item active">{{ location_page.title }}</li></a>
			{% else %}
				<a href="{% pageurl location_page  %}">
					<li class="list-group-item">
						{{location_page.title}}
					</li>
				</a>
			
			{% endif %}
		{% endfor %}	
	</ul>
    {% endif %}

    
    <h4 class="text-center mt-5"> Browse by Tag üè∑Ô∏è :</h4>
	<div class="d-flex flex-row justify-content-around mt-5 px-2">

    		{% for tag, pages in locationpagetags.items %}
        		<div>
            			<a href="{% slugurl 'tags' %}?tag={{ tag }}">

					<button type="button" class="btn btn-primary">
 		 				{{tag | title }} 
					</button>

           			 </a>
        		</div>
    		{% endfor %}
	</div>

    <script>
        function setCookie(name, value, seconds) {
            var expires = "";
            if (seconds) {
                var date = new Date();
                date.setTime(date.getTime() + (seconds * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "")  + expires + "; path=/";
        }

        function getCookie(name) {
            var nameEQ = name + "=";
            var ca = document.cookie.split(';');
            for(var i=0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        function setPositionAndReload(position) {
            setCookie('geo', position.coords.latitude + ',' + position.coords.longitude, 300);
            location.reload();
        }
    
        if (getCookie('geo') == null) {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(setPositionAndReload);
            }
        }
    </script>

{% endblock %}
